// Â© 2025 Nexus Macro Strategy (Backtest Engine v0.0.1)
// @version=6
strategy("Nexus Macro Strategy [v0.0.1]", 
     shorttitle="NMS_v0.0.1", 
     overlay=true, 
     initial_capital=10000, 
     default_qty_type=strategy.percent_of_equity, 
     default_qty_value=10, 
     commission_type=strategy.commission.percent, 
     commission_value=0.075)

// =============================================================================
// âš™ï¸ STRATEJÄ° AYARLARI
// =============================================================================
var G1 = "Sinyal AyarlarÄ±"
int pivot_len = input.int(15, "Pivot Hassasiyeti", minval=1, group=G1)

var G2 = "Risk YÃ¶netimi"
float rr_ratio = input.float(2.0, "Hedef Kar (Risk/Ã–dÃ¼l)", minval=0.1, group=G2)
float risk_per_trade = input.float(1.0, "Ä°ÅŸlem BaÅŸÄ±na Risk (%)", minval=0.1, group=G2)

// =============================================================================
// ğŸ” ANALÄ°Z MANTIÄI
// =============================================================================
// Ä°ndikatÃ¶rÃ¼mÃ¼zle aynÄ± mantÄ±k: Pivot High ve Pivot Low noktalarÄ±nÄ± buluyoruz.
float ph = ta.pivothigh(high, pivot_len, pivot_len)
float pl = ta.pivotlow(low, pivot_len, pivot_len)
float atr = ta.atr(14)

// =============================================================================
// ğŸ“ˆ Ä°ÅLEM KURALLARI (ENTRY / EXIT)
// =============================================================================

// --- SHORT (SAT) KURGUSU ---
if not na(ph)
    float stopLoss = ph
    float entry    = ph - (atr * 0.5)
    float distance = math.abs(stopLoss - entry)
    float takeProfit = entry - (distance * rr_ratio)
    
    // Ä°ÅŸleme GiriÅŸ: Limit emir kullanarak indikatÃ¶rÃ¼n ENTRY Ã§izgisine gÃ¶re girer.
    strategy.entry("Short", strategy.short, limit=entry, comment="Short_Entry")
    // Ã‡Ä±kÄ±ÅŸ KoÅŸullarÄ±: SL ve TP noktalarÄ± indikatÃ¶r seviyeleriyle aynÄ±dÄ±r.
    strategy.exit("Short Exit", "Short", stop=stopLoss, limit=takeProfit, comment_loss="SL", comment_profit="TP")

// --- LONG (AL) KURGUSU ---
if not na(pl)
    float stopLoss = pl
    float entry    = pl + (atr * 0.5)
    float distance = math.abs(entry - stopLoss)
    float takeProfit = entry + (distance * rr_ratio)
    
    strategy.entry("Long", strategy.long, limit=entry, comment="Long_Entry")
    strategy.exit("Long Exit", "Long", stop=stopLoss, limit=takeProfit, comment_loss="SL", comment_profit="TP")

// =============================================================================
// ğŸ¨ GÃ–RSEL DOLGU (Strateji Testini KolaylaÅŸtÄ±rmak Ä°Ã§in)
// =============================================================================
// Strateji Ã§alÄ±ÅŸÄ±rken arka planda Pivot noktalarÄ±nÄ± iÅŸaretleyelim ki neden girdiÄŸini gÃ¶relim.
plotshape(ph, style=shape.triangledown, location=location.abovebar, color=color.red, size=size.tiny, title="Pivot High")
plotshape(pl, style=shape.triangleup, location=location.belowbar, color=color.green, size=size.tiny, title="Pivot Low")
